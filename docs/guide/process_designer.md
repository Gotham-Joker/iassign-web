# 流程设计器(Process Designer)
流程设计器用于设计审批流程，除了支持人员审批外，还支持系统处理，系统处理环节一般用于对接外部系统。

---
进入流程设计器，请从系统菜单"工作流"=>"流程管理"进入，点击“添加流程”，即可进入流程设计器，如下图所示。
![进入流程设计器](/images/processDesigner0.png)

下面介绍下流程设计器左边的控件
![流程设计器](/images/processDesigner1.png)
从上往下依次是 “开始” “审批” “网关” “系统” “结束”
所有的控件均可拖入流程图中。

## 连线
控件拖入流程图之后，若想要连线，需要将鼠标移动到控件的 "上下左右" 边缘部分，此时鼠标指针会变成十字线，按住鼠标左键一拉即可引出连线。
若要删除连线，需要鼠标右键点击连线，选择“删除”。想要调整连线，也可以鼠标右键点击连线，选择“调整”，然后再对线条进行弯曲度进行调节。
如果要对连线增加备注，可以双击鼠标左键，对连线进行编辑，如下图所示![编辑连线](/images/processDesigner2.png)。
连线可以设置条件，需要配合“网关”使用，这将会在网关讲解。


## "开始"控件
开始控件只能有一个外出箭头，且不能有进入的箭头。一个流程图只能有一个开始环节。
## "审批"控件
审批控件只能有一个外出箭头，允许有多个进入的箭头。一个流程图中可以存在很多个审批环节。
在审批节点上，可以定义审批环节的名称。
### 审批人可以是固定值也可以是变数。 
- 固定值：选择固定的审批人或者审批角色。
- 常规变数：{申请人}和{上一处理人的主管}这些带有花括号的，都属于变数。
- 自定义变数：如果常规变数不能满足要求，也可以在“高级”一栏中，
填写自己的表达式，得出自己的变数(QL Express，这个是高级用法，面向开发人员，类似java语言)。也可以
从表单变量而来，例如在用表单设计器的时候设计了一个"字段"为userId的输入框，那么在这个表达式中可以直接使用，例如在审批人列表(script)中填入userId，
那么在表单中填写的userId，将会变成这里的审批人，以此类推，如下两张图所示。
![表单设计了一个userId](/images/processDesigner3.png)
![审批节点中使用userId变数](/images/processDesigner4.png)

审批节点也可以绑定表单，这样审批人除了填写自己的审批意见以外，还有完成额外的表单才可以提交。
![绑定表单ID](/images/processDesigner10.png)

## “网关”控件
![网关控件](/images/gateway.png)

网关控件用于产生条件分支，网关允许有多个外出线路，审批流转经过网关的时候，系统会判断该往哪里走，例如下面的例子中
1. 我们设计了一个贷款的表单，使用了“数字”控件，并在“字段”一栏中将其命名为“amount”，“标签”中填入贷款金额。![表单设计了一个数字控件，表示贷款](/images/processDesigner5.png)
2. 在流程图中增加一个“网关”节点，当用户输入的“贷款金额”超出1万，我们希望系统就会往“领导层”审批那条路线走，否则，
走“系统处理”的路线。那么我们应该对右边的路线，双击鼠标左键进行设置，在路线的标签中填入`贷款金额超出1万`，然后
条件中写上表达式`amount > 100000`，下面的那条线路不需要进行任何配置， 因为当不满足`amount > 10000`这个条件时，系统会自动寻找其他可用的路线，
所以，最起码应该保留一个“无任何条件”的路线给系统作为最后的选择。
![设计条件分支](/images/processDesigner6.png)

## "系统"控件
系统处理，可以写http和QL表达式，一般是给会编程的开发人员使用。 注意，可以将http返回结果放入上下文中，例如填写完HTTP配置之后，
还可以在脚本中写`CTX.put("code",HTTP_RESULT)`，代表将http返回的结果存入上下文变量code中，之后的流程节点就可以使用这个变量。

## "结束"控件
结束控件可以有多个，但是只能有进入的路线，不能有出去的路线。

## 写在最后
---
一个完整的流程必须有始有终。此外还要进行其他的配置、部署才能够使用：
1. 设定启动表单，即发起流程的时候需要填写什么表单。比如说，休假的时候需要填写《请假申请表》。
![配置表单](/images/processDesigner7.png)
![配置流程](/images/processDesigner8.png)
![配置表单](/images/processDesigner9.png)

最后要记得保存和部署上线。