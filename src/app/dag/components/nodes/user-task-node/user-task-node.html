<!--
  ~ MIT License
  ~
  ~ Copyright (c) 2024 Hongtao Liu
  ~
  ~ Permission is hereby granted, free of charge, to any person obtaining a copy
  ~ of this software and associated documentation files (the "Software"), to deal
  ~ in the Software without restriction, including without limitation the rights
  ~ to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
  ~ copies of the Software, and to permit persons to whom the Software is
  ~ furnished to do so, subject to the following conditions:
  ~
  ~ The above copyright notice and this permission notice shall be included in all
  ~ copies or substantial portions of the Software.
  ~
  ~ THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  ~ IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  ~ FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
  ~ AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  ~ LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
  ~ OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  ~ SOFTWARE.
  ~
  -->

<div class="node" [ngClass]="data.status" (dblclick)="interacting?edit():''"
     (contextmenu)="interacting?onContextMenu.emit({ev:$event,cell}):''">
    <span nz-icon nzType="svg:user_task" class="ico"></span>
    <span class="label">{{ data?.label }}</span>
    @if (data.status != null && data.status != 'default') {
        <span class="status">
        <img [src]="image[data.status]">
    </span>
    }
</div>

<nz-drawer [nzVisible]="visible"
           nzCloseIcon="svg:close"
           (nzOnClose)="close()" [nzContent]="content">
    <ng-template #content>
        <h3 class="text-gradient bg-gradient-info">节点设置</h3>
        <nz-tabset>
            <nz-tab nzTitle="常规">
                <div nz-form nzLayout="vertical">
                    <nz-form-item>
                        <nz-form-label nzRequired>标签</nz-form-label>
                        <nz-form-control>
                            <input nz-input [(ngModel)]="data.label">
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label>审批表单ID</nz-form-label>
                        <nz-form-control>
                            <input nz-input [(ngModel)]="data.formId">
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label>会签</nz-form-label>
                        <nz-form-control>
                            <nz-radio-group [(ngModel)]="data.countersign">
                                <label nz-radio [nzValue]="true">是</label>
                                <label nz-radio [nzValue]="false">否</label>
                            </nz-radio-group>
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label>指派</nz-form-label>
                        <nz-form-control>
                            <nz-radio-group [(ngModel)]="data.assign">
                                <label nz-radio [nzValue]="true">允许</label>
                                <label nz-radio [nzValue]="false">禁止</label>
                            </nz-radio-group>
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label>附件</nz-form-label>
                        <nz-form-control>
                            <nz-radio-group [(ngModel)]="data.fileRequired">
                                <label nz-radio [nzValue]="true">必传</label>
                                <label nz-radio [nzValue]="false">选传</label>
                            </nz-radio-group>
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label>审批人</nz-form-label>
                        <nz-form-control>
                            <nz-select nzMode="multiple" nzAllowClear
                                       [nzOptions]="userOptions"
                                       [(ngModel)]="data.userList" (ngModelChange)="detectChanges()"></nz-select>
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label>审批角色</nz-form-label>
                        <nz-form-control>
                            <nz-select nzMode="multiple" nzAllowClear
                                       [nzOptions]="roleOptions"
                                       [(ngModel)]="data.roleList" (ngModelChange)="detectChanges()">
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </nz-tab>
            <nz-tab nzTitle="高级">
                <div nz-form nzLayout="vertical">
                    <nz-form-item>
                        <nz-form-label>审批人列表(script)</nz-form-label>
                        <nz-form-control>
                            <textarea [(ngModel)]="data.userScript" nz-input
                                      placeholder="返回值可以是String或List<String>"></textarea>
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label>审批角色列表(script)</nz-form-label>
                        <nz-form-control>
                            <textarea [(ngModel)]="data.roleScript" nz-input
                                      placeholder="返回值可以是String或List<String>"></textarea>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </nz-tab>
        </nz-tabset>
        <button nz-button nzType="primary" nzBlock nzShape="round" (click)="save()">保存</button>
    </ng-template>
</nz-drawer>
