<!--
  ~ MIT License
  ~
  ~ Copyright (c) 2024 Hongtao Liu
  ~
  ~ Permission is hereby granted, free of charge, to any person obtaining a copy
  ~ of this software and associated documentation files (the "Software"), to deal
  ~ in the Software without restriction, including without limitation the rights
  ~ to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
  ~ copies of the Software, and to permit persons to whom the Software is
  ~ furnished to do so, subject to the following conditions:
  ~
  ~ The above copyright notice and this permission notice shall be included in all
  ~ copies or substantial portions of the Software.
  ~
  ~ THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  ~ IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  ~ FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
  ~ AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  ~ LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
  ~ OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  ~ SOFTWARE.
  ~
  -->

<!-- 指派清单 -->
<nz-modal nzCloseIcon="svg:close" [(nzVisible)]="visible" [nzContent]="assignContent"
          (nzOnCancel)="hide()" (nzOnOk)="assign()" nzOkText="指派">
    <ng-template #assignContent>
        <div class="mt-3">
            <div class="text-black b-t b-t-solid b-purple-500 fw-bold text-lg">指派給其他用户处理，并发送邮件给对方</div>
            <p class="text-gray-600 my-4">
                请注意：如果用户没有邮箱地址或者邮箱地址不正确，系统会忽略这些用户，若发现指派清单中查找不到用户，请反馈问题</p>
            <div class="my-4">
                <div nz-row nzGutter="32">
                    <span nz-col nzSpan="6" class="font-bold text-gray-500 text-right">Operation:</span>
                    <span nz-col nzSpan="18" class="text-left">
                      指派
                    </span>
                </div>
                <div nz-row nzGutter="32" class="mt-3 flex items-center">
                    <span nz-col nzSpan="6" class="font-bold text-gray-500 text-right">Assign to:</span>
                    <span nz-col nzSpan="18" class="text-left">
                        <span class="flex items-center">
                            @if (isAssigning) {
                                <nz-select style="min-width: 180px" nzShowSearch nzServerSearch
                                           nzPlaceHolder="请输入姓名或邮箱" [(ngModel)]="selectedValue"
                                           [nzShowArrow]="false" [nzFilterOption]="nzFilterOption"
                                           (nzOnSearch)="search($event)"
                                           (ngModelChange)="confirm($event)">
                                    @for (item of options; track $index) {
                                        <nz-option [nzLabel]="item.username+'('+item.email+')'"
                                                   [nzValue]="item"></nz-option>
                                    }
                                </nz-select>
                            } @else {
                                <nz-avatar [nzSrc]="avatar"></nz-avatar>
                                <span class="mx-2 fw-bold">{{ data.username }}</span>
                                <a (click)="isAssigning=true">
                                    <span class="text-base" nz-icon nzType="svg:switch"></span>
                                </a>
                            }
                        </span>
                    </span>
                </div>
                <div nz-row nzGutter="32" class="my-3 flex items-center">
                    <span nz-col nzSpan="6" class="font-bold text-gray-500 text-right">Email:</span>
                    <span nz-col nzSpan="18" class="text-left">
                        <span class="flex items-center">
                           {{ data?.email }}
                        </span>
                    </span>
                </div>
            </div>
            <div class="b-t b-t-solid b-gray-300">
                <div class="my-3 fw-bold">Remark（备注）</div>
                <div class="flex justify-between items-center">
                    <nz-avatar class="flex-shrink-0" [nzSrc]="startupSvc.userInfo.avatar"></nz-avatar>
                    <input nz-input class="important-mx-2" [(ngModel)]="modal.assignRemark">
                    <div class="rounded bg-purple-500 px-3 py-1 text-white cursor-pointer hover:bg-purple-400"
                         (click)="changeAssignRemark()">
                        <span nz-icon nzType="svg:send"></span>
                    </div>
                </div>
            </div>
            @if (data?.remark) {
                <p class="rounded mt-3 p-2 bg-gray-50">{{ data?.remark }}</p>
            }
        </div>
    </ng-template>
</nz-modal>